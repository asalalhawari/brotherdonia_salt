//@version=5
indicator(title="UT Bot Alerts", overlay=true)

// ğŸŸ¢ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª (Inputs)
a = input(1, title="Key Value. 'This changes the sensitivity'")
c = input(10, title="ATR Period")
h = input(true, title="Signals from Heikin Ashi Candles")

// ğŸŸ¢ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù€ ATR
xATR = ta.atr(c)
nLoss = a * xATR

// ğŸŸ¢ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø´Ù…ÙˆØ¹ Heikin Ashi Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙØ¹Ù„Ù‡Ø§
haClose = request.security(syminfo.tickerid, timeframe.period, ta.ha(close))
src = h ? haClose : close

// ğŸŸ¢ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù€ ATR Trailing Stop
xATRTrailingStop = 0.0

xATRTrailingStop := if(src > nz(xATRTrailingStop[1], 0) and src[1] > nz(xATRTrailingStop[1], 0), max(nz(xATRTrailingStop[1]), src - nLoss),
   if(src < nz(xATRTrailingStop[1], 0) and src[1] < nz(xATRTrailingStop[1], 0), min(nz(xATRTrailingStop[1]), src + nLoss), 
   if(src > nz(xATRTrailingStop[1], 0), src - nLoss, src + nLoss)))
 

// ğŸŸ¢ ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© Ø§Ù„ØµÙÙ‚Ø© (Long Ø£Ùˆ Short)
var int pos = 0
pos := 
    src[1] < nz(xATRTrailingStop[1]) and src > nz(xATRTrailingStop[1]) ? 1 :
    src[1] > nz(xATRTrailingStop[1]) and src < nz(xATRTrailingStop[1]) ? -1 : nz(pos[1])

xcolor = pos == -1 ? color.red : pos == 1 ? color.green : color.blue

// ğŸŸ¢ Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„Ø¨ÙŠØ¹
ema = ta.ema(src, 1)
above = ta.crossover(ema, xATRTrailingStop)
below = ta.crossunder(ema, xATRTrailingStop)

buy = src > xATRTrailingStop and above
sell = src < xATRTrailingStop and below

barbuy = src > xATRTrailingStop
barsell = src < xATRTrailingStop

// ğŸŸ¢ Ø±Ø³Ù… Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„Ø¨ÙŠØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø®Ø·Ø·
plotshape(buy, title="Buy", text='Buy', style=shape.labelup, location=location.belowbar, color=color.green, textcolor=color.white, size=size.tiny)
plotshape(sell, title="Sell", text='Sell', style=shape.labeldown, location=location.abovebar, color=color.red, textcolor=color.white, size=size.tiny)

// ğŸŸ¢ ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø´Ù…ÙˆØ¹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø©
barcolor(barbuy ? color.green : na)
barcolor(barsell ? color.red : na)

// ğŸŸ¢ Ø¥Ù†Ø´Ø§Ø¡ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬
alertcondition(buy, title="UT Long", message="UT Long Signal")
alertcondition(sell, title="UT Short", message="UT Short Signal")
